document.addEventListener("DOMContentLoaded",(()=>{const e=[];Object.entries({cards:".card-wrapper",filterButton:".button-filter",resetButton:".button-reset",bedroomWrappers:".bedroom-wrapper",priceRange:".price-range",sqrRange:".sqr-range"}).forEach((([t,n])=>{const r=document.querySelectorAll(n);0===r.length&&e.push(n),r.length})),e.length>0&&(console.warn("❌ Missing required CSS classes:",e),e.forEach((e=>console.log(`   - ${e}`))));document.querySelectorAll("[applylink]").forEach((function(e){const t=e.getAttribute("applylink");t&&e.setAttribute("href",t)}));const t=document.querySelectorAll(".card-wrapper"),n=document.querySelector(".button-filter"),r=document.querySelector(".button-reset"),a=document.querySelectorAll(".bedroom-wrapper"),l=document.querySelectorAll('.bedroom-wrapper input[type="checkbox"]'),o=document.querySelector(".price-range"),s=o?.querySelector(".price-min-handler"),c=o?.querySelector(".price-max-handler"),i=o?.querySelector(".price-range-bar"),u=o?.querySelector(".price-min"),d=o?.querySelector(".price-max"),p=s?.closest(".rangeslider_track"),m=document.querySelector(".sqr-range"),y=m?.querySelector(".sqr-min-handler"),f=m?.querySelector(".sqr-max-handler"),x=m?.querySelector(".sqr-range-bar"),h=m?.querySelector(".sqr-min"),q=m?.querySelector(".sqr-max"),S=y?.closest(".rangeslider_track"),v=document.querySelector('[fs-cmsfilter-element="results-count"]'),g=document.querySelector('[fs-cmsfilter-element="items-count"]');let M=1/0,C=-1/0,w=1/0,b=-1/0;const N=new Set,E=[],parseVal=(e,t,n=!1)=>{const r=e.querySelector(t);if(!r||!r.textContent)return null;const a=r.textContent.trim().replace(/[^0-9.]+/g,"");if(""===a)return null;const l=n?parseFloat(a):parseInt(a,10);return isNaN(l)?null:l},formatCurrency=e=>"$"+Math.round(e).toString(),formatSqft=e=>Math.round(e).toString();function updateResultsCount(e){v&&(v.textContent=e)}function setupRangeSlider(e,t,n,r,a,l,o,s,c){if(!(t&&n&&r&&a&&l&&o&&s))return void console.warn(`Cannot setup slider "${e}": Missing one or more required elements.`,{minHandle:t,maxHandle:n,rangeBar:r,minDisplay:a,maxDisplay:l,track:o,rangeContainer:s});let i,u,d,p,m,y,f=!1,x=!1;const updateSliderVisuals=(o=!1)=>{t.style.left=t.style.left||"0%",n.style.left=n.style.left||"100%";const i=parseFloat(t.style.left),u=parseFloat(n.style.left);r.style.left=`${i}%`,r.style.width=u-i+"%";const d=parseFloat(s.dataset.min),p=parseFloat(s.dataset.max);if(!isNaN(d)&&!isNaN(p)&&p>=d){const e=d+i/100*(p-d),t=d+u/100*(p-d);a.textContent=c(e),l.textContent=c(t)}else o&&(console.warn(`Slider "${e}" data attributes invalid during initial visual update.`),a.textContent=c(0),l.textContent=c(1e3))},onDragStart=(r,a)=>{r.preventDefault(),r.stopPropagation();const l=a===t;if(f=l,x=!l,m=parseFloat(s.dataset.min),y=parseFloat(s.dataset.max),isNaN(m)||isNaN(y)||y<m)return console.error(`Slider "${e}" has invalid min/max data attributes at drag start:`,s.dataset.min,s.dataset.max),void(f=x=!1);i=r.type.startsWith("touch")?r.touches[0].clientX:r.clientX,u=parseFloat(a.style.left||(l?"0":"100"));const c=o.getBoundingClientRect();if(d=c.width,p=c.left,d<=0)return console.error(`Slider "${e}" track has zero or negative width (${d}px). Cannot calculate drag.`),void(f=x=!1);document.addEventListener("mousemove",onDragging),document.addEventListener("touchmove",onDragging,{passive:!1}),document.addEventListener("mouseup",onDragEnd),document.addEventListener("touchend",onDragEnd),document.body.style.userSelect="none",a.style.zIndex="10",l?n.style.zIndex="5":t.style.zIndex="5"},onDragging=e=>{if(!f&&!x)return;e.type.startsWith("touch")&&e.preventDefault();const r=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX;let a=u+(r-i)/d*100;a=Math.max(0,Math.min(100,a));const l=parseFloat((f?n.style.left:t.style.left)||(f?"100":"0"));f?(a=Math.min(a,l),t.style.left=`${a}%`):(a=Math.max(a,l),n.style.left=`${a}%`),updateSliderVisuals()},onDragEnd=e=>{(f||x)&&(f=!1,x=!1,document.removeEventListener("mousemove",onDragging),document.removeEventListener("touchmove",onDragging),document.removeEventListener("mouseup",onDragEnd),document.removeEventListener("touchend",onDragEnd),document.body.style.userSelect="",t.style.zIndex="",n.style.zIndex="")};t.addEventListener("mousedown",(e=>onDragStart(e,t))),t.addEventListener("touchstart",(e=>onDragStart(e,t)),{passive:!0}),n.addEventListener("mousedown",(e=>onDragStart(e,n))),n.addEventListener("touchstart",(e=>onDragStart(e,n)),{passive:!0}),updateSliderVisuals(!0)}n?n.addEventListener("click",(e=>{e.preventDefault(),function(){const e=Array.from(l).filter((e=>e.checked)).map((e=>{const t=e.closest(".bedroom-wrapper")?.querySelector(".bedroom-value");return t?parseInt(t.textContent.trim(),10):NaN})).filter((e=>!isNaN(e))),t=parseFloat(u?.textContent.replace(/[^0-9.]+/g,""))||M,n=parseFloat(d?.textContent.replace(/[^0-9.]+/g,""))||C,r=parseFloat(h?.textContent.replace(/[^0-9.]+/g,""))||w,a=parseFloat(q?.textContent.replace(/[^0-9.]+/g,""))||b;let o=0;E.forEach((l=>{let s=!0;e.length>0&&(null===l.bed||!e.includes(l.bed))&&(s=!1),s&&u&&d&&null!==l.priceMax&&null!==l.priceMin?(l.priceMax<t||l.priceMin>n)&&(s=!1):s&&u&&d&&(null===l.priceMax||l.priceMin),s&&h&&q&&null!==l.sqrMax&&null!==l.sqrMin?(l.sqrMax<r||l.sqrMin>a)&&(s=!1):s&&h&&q&&(null===l.sqrMax||l.sqrMin),l.element.style.display=s?"":"none",s&&o++})),updateResultsCount(o)}()})):console.warn("Filter button (.button-filter) not found."),r?r.addEventListener("click",(e=>{e.preventDefault(),function(){if(l.forEach((e=>e.checked=!1)),o&&s&&c&&i&&u&&d){s.style.left="0%",c.style.left="100%",i.style.left="0%",i.style.width="100%";const e=parseFloat(o.dataset.min),t=parseFloat(o.dataset.max);u.textContent=formatCurrency(isNaN(e)?0:e),d.textContent=formatCurrency(isNaN(t)?1e3:t)}if(m&&y&&f&&x&&h&&q){y.style.left="0%",f.style.left="100%",x.style.left="0%",x.style.width="100%";const e=parseFloat(m.dataset.min),t=parseFloat(m.dataset.max);h.textContent=formatSqft(isNaN(e)?0:e),q.textContent=formatSqft(isNaN(t)?2e3:t)}E.forEach((e=>{e.element.style.display=""})),updateResultsCount(E.length)}()})):console.warn("Reset button (.button-reset) not found."),function(){if(!t||0===t.length){console.warn("❌ No cards found with class '.card-wrapper'");[document.querySelectorAll('[class*="card"]'),document.querySelectorAll('[class*="floor-plan"]'),document.querySelectorAll('[class*="unit"]'),document.querySelectorAll('[class*="listing"]')].forEach(((e,t)=>{e.length>0&&(e.length,e[0].className)}))}M=1/0,C=-1/0,w=1/0,b=-1/0,N.clear(),E.length=0,t&&0!==t.length?t.forEach(((e,t)=>{const n={element:e,bed:parseVal(e,".bedroom-card-value"),priceMin:parseVal(e,".price-min-card-value"),priceMax:parseVal(e,".price-max-card-value"),sqrMin:parseVal(e,".sqr-min-card-value"),sqrMax:parseVal(e,".sqr-max-card-value")};E.push(n),null!==n.bed&&N.add(n.bed),null!==n.priceMin&&(M=Math.min(M,n.priceMin)),null!==n.priceMax&&(C=Math.max(C,n.priceMax)),null!==n.sqrMin&&(w=Math.min(w,n.sqrMin)),null!==n.sqrMax&&(b=Math.max(b,n.sqrMax))})):(console.warn("No cards found with class '.card-wrapper'. Filtering will not work."),M=0,C=1e3,w=0,b=2e3),M===1/0&&(M=0),(C===-1/0||C<M)&&(C=Math.max(1e3,M)),w===1/0&&(w=0),(b===-1/0||b<w)&&(b=Math.max(2e3,w)),C<=M&&(C=M+1),b<=w&&(b=w+1),a.forEach((e=>{const t=e.querySelector(".bedroom-value"),n=t?parseInt(t.textContent.trim(),10):NaN;t&&!isNaN(n)?e.style.display=N.has(n)?"":"none":e.style.display="none"})),o&&u&&d?(u.textContent=formatCurrency(M),d.textContent=formatCurrency(C),o.dataset.min=M,o.dataset.max=C,s&&(s.style.left="0%"),c&&(c.style.left="100%"),i&&(i.style.left="0%",i.style.width="100%"),o.dataset.min,o.dataset.max):console.warn("❌ Price slider UI elements not found:"),m&&h&&q?(h.textContent=formatSqft(w),q.textContent=formatSqft(b),m.dataset.min=w,m.dataset.max=b,y&&(y.style.left="0%"),f&&(f.style.left="100%"),x&&(x.style.left="0%",x.style.width="100%"),m.dataset.min,m.dataset.max):console.warn("❌ Area slider UI elements not found:");const e=E.length;updateResultsCount(e),g&&(g.textContent=e)}(),setupRangeSlider("Price",s,c,i,u,d,p,o,formatCurrency),setupRangeSlider("Area",y,f,x,h,q,S,m,formatSqft);document.querySelectorAll(".card-wrapper").forEach((function(e){const t=e.querySelector(".sqr-min-card-value"),n=e.querySelector(".sqr-max-card-value"),r=e.querySelector(".sqr-spacer");t&&n&&r&&t.textContent===n.textContent&&(r.style.display="none",n.style.display="none");const a=e.querySelector(".price-min-card-value"),l=e.querySelector(".price-max-card-value"),o=e.querySelector(".price-spacer"),s=e.querySelector(".price-max-dollar"),c=e.querySelector(".startingat");a&&l&&o&&a.textContent===l.textContent&&(o.style.display="none",l.style.display="none",s&&(s.style.display="none"),c&&(c.style.display="inline"))}))}));