document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[applylink]").forEach((function(e){const t=e.getAttribute("applylink");t&&e.setAttribute("href",t)}));const e=document.querySelectorAll(".card-wrapper"),t=document.querySelector(".button-filter"),n=document.querySelector(".button-reset"),r=document.querySelectorAll(".bedroom-wrapper"),a=document.querySelectorAll('.bedroom-wrapper input[type="checkbox"]'),l=document.querySelector(".price-range"),s=l?.querySelector(".price-min-handler"),o=l?.querySelector(".price-max-handler"),i=l?.querySelector(".price-range-bar"),c=l?.querySelector(".price-min"),d=l?.querySelector(".price-max"),u=s?.closest(".rangeslider_track"),m=document.querySelector(".sqr-range"),p=m?.querySelector(".sqr-min-handler"),y=m?.querySelector(".sqr-max-handler"),x=m?.querySelector(".sqr-range-bar"),f=m?.querySelector(".sqr-min"),h=m?.querySelector(".sqr-max"),q=p?.closest(".rangeslider_track"),v=document.querySelector('[fs-cmsfilter-element="results-count"]'),S=document.querySelector('[fs-cmsfilter-element="items-count"]');let M=1/0,C=-1/0,g=1/0,N=-1/0;const b=new Set,w=[],parseVal=(e,t,n=!1)=>{const r=e.querySelector(t);if(!r||!r.textContent)return null;const a=r.textContent.trim().replace(/[^0-9.]+/g,"");if(""===a)return null;const l=n?parseFloat(a):parseInt(a,10);return isNaN(l)?null:l},formatCurrency=e=>"$"+Math.round(e).toString(),formatSqft=e=>Math.round(e).toString();function updateResultsCount(e){v&&(v.textContent=e)}function setupRangeSlider(e,t,n,r,a,l,s,o,i){if(!(t&&n&&r&&a&&l&&s&&o))return void console.warn(`Cannot setup slider "${e}": Missing one or more required elements.`,{minHandle:t,maxHandle:n,rangeBar:r,minDisplay:a,maxDisplay:l,track:s,rangeContainer:o});let c,d,u,m,p,y,x=!1,f=!1;const updateSliderVisuals=(s=!1)=>{t.style.left=t.style.left||"0%",n.style.left=n.style.left||"100%";const c=parseFloat(t.style.left),d=parseFloat(n.style.left);r.style.left=`${c}%`,r.style.width=d-c+"%";const u=parseFloat(o.dataset.min),m=parseFloat(o.dataset.max);if(!isNaN(u)&&!isNaN(m)&&m>=u){const e=u+c/100*(m-u),t=u+d/100*(m-u);a.textContent=i(e),l.textContent=i(t)}else s&&(console.warn(`Slider "${e}" data attributes invalid during initial visual update.`),a.textContent=i(0),l.textContent=i(1e3))},onDragStart=(r,a)=>{r.preventDefault(),r.stopPropagation();const l=a===t;if(x=l,f=!l,p=parseFloat(o.dataset.min),y=parseFloat(o.dataset.max),isNaN(p)||isNaN(y)||y<p)return console.error(`Slider "${e}" has invalid min/max data attributes at drag start:`,o.dataset.min,o.dataset.max),void(x=f=!1);c=r.type.startsWith("touch")?r.touches[0].clientX:r.clientX,d=parseFloat(a.style.left||(l?"0":"100"));const i=s.getBoundingClientRect();if(u=i.width,m=i.left,u<=0)return console.error(`Slider "${e}" track has zero or negative width (${u}px). Cannot calculate drag.`),void(x=f=!1);document.addEventListener("mousemove",onDragging),document.addEventListener("touchmove",onDragging,{passive:!1}),document.addEventListener("mouseup",onDragEnd),document.addEventListener("touchend",onDragEnd),document.body.style.userSelect="none",a.style.zIndex="10",l?n.style.zIndex="5":t.style.zIndex="5"},onDragging=e=>{if(!x&&!f)return;e.type.startsWith("touch")&&e.preventDefault();const r=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX;let a=d+(r-c)/u*100;a=Math.max(0,Math.min(100,a));const l=parseFloat((x?n.style.left:t.style.left)||(x?"100":"0"));x?(a=Math.min(a,l),t.style.left=`${a}%`):(a=Math.max(a,l),n.style.left=`${a}%`),updateSliderVisuals()},onDragEnd=e=>{(x||f)&&(x=!1,f=!1,document.removeEventListener("mousemove",onDragging),document.removeEventListener("touchmove",onDragging),document.removeEventListener("mouseup",onDragEnd),document.removeEventListener("touchend",onDragEnd),document.body.style.userSelect="",t.style.zIndex="",n.style.zIndex="")};t.addEventListener("mousedown",(e=>onDragStart(e,t))),t.addEventListener("touchstart",(e=>onDragStart(e,t)),{passive:!0}),n.addEventListener("mousedown",(e=>onDragStart(e,n))),n.addEventListener("touchstart",(e=>onDragStart(e,n)),{passive:!0}),updateSliderVisuals(!0)}t?t.addEventListener("click",(e=>{e.preventDefault(),function(){const e=Array.from(a).filter((e=>e.checked)).map((e=>{const t=e.closest(".bedroom-wrapper")?.querySelector(".bedroom-value");return t?parseInt(t.textContent.trim(),10):NaN})).filter((e=>!isNaN(e))),t=parseFloat(c?.textContent.replace(/[^0-9.]+/g,""))||M,n=parseFloat(d?.textContent.replace(/[^0-9.]+/g,""))||C,r=parseFloat(f?.textContent.replace(/[^0-9.]+/g,""))||g,l=parseFloat(h?.textContent.replace(/[^0-9.]+/g,""))||N;let s=0;w.forEach((a=>{let o=!0;e.length>0&&(null===a.bed||!e.includes(a.bed))&&(o=!1),o&&c&&d&&null!==a.priceMax&&null!==a.priceMin?(a.priceMax<t||a.priceMin>n)&&(o=!1):o&&c&&d&&(null===a.priceMax||a.priceMin),o&&f&&h&&null!==a.sqrMax&&null!==a.sqrMin?(a.sqrMax<r||a.sqrMin>l)&&(o=!1):o&&f&&h&&(null===a.sqrMax||a.sqrMin),a.element.style.display=o?"":"none",o&&s++})),updateResultsCount(s)}()})):console.warn("Filter button (.button-filter) not found."),n?n.addEventListener("click",(e=>{e.preventDefault(),function(){if(a.forEach((e=>e.checked=!1)),l&&s&&o&&i&&c&&d){s.style.left="0%",o.style.left="100%",i.style.left="0%",i.style.width="100%";const e=parseFloat(l.dataset.min),t=parseFloat(l.dataset.max);c.textContent=formatCurrency(isNaN(e)?0:e),d.textContent=formatCurrency(isNaN(t)?1e3:t)}if(m&&p&&y&&x&&f&&h){p.style.left="0%",y.style.left="100%",x.style.left="0%",x.style.width="100%";const e=parseFloat(m.dataset.min),t=parseFloat(m.dataset.max);f.textContent=formatSqft(isNaN(e)?0:e),h.textContent=formatSqft(isNaN(t)?2e3:t)}w.forEach((e=>{e.element.style.display=""})),updateResultsCount(w.length)}()})):console.warn("Reset button (.button-reset) not found."),function(){M=1/0,C=-1/0,g=1/0,N=-1/0,b.clear(),w.length=0,e&&0!==e.length?e.forEach(((e,t)=>{const n={element:e,bed:parseVal(e,".bedroom-card-value"),priceMin:parseVal(e,".price-min-card-value"),priceMax:parseVal(e,".price-max-card-value"),sqrMin:parseVal(e,".sqr-min-card-value"),sqrMax:parseVal(e,".sqr-max-card-value")};w.push(n),null!==n.bed&&b.add(n.bed),null!==n.priceMin&&(M=Math.min(M,n.priceMin)),null!==n.priceMax&&(C=Math.max(C,n.priceMax)),null!==n.sqrMin&&(g=Math.min(g,n.sqrMin)),null!==n.sqrMax&&(N=Math.max(N,n.sqrMax))})):(console.warn("No cards found with class '.card-wrapper'. Filtering will not work."),M=0,C=1e3,g=0,N=2e3),M===1/0&&(M=0),(C===-1/0||C<M)&&(C=Math.max(1e3,M)),g===1/0&&(g=0),(N===-1/0||N<g)&&(N=Math.max(2e3,g)),C<=M&&(C=M+1),N<=g&&(N=g+1),r.forEach((e=>{const t=e.querySelector(".bedroom-value"),n=t?parseInt(t.textContent.trim(),10):NaN;t&&!isNaN(n)?e.style.display=b.has(n)?"":"none":e.style.display="none"})),l&&c&&d?(c.textContent=formatCurrency(M),d.textContent=formatCurrency(C),l.dataset.min=M,l.dataset.max=C,s&&(s.style.left="0%"),o&&(o.style.left="100%"),i&&(i.style.left="0%",i.style.width="100%"),l.dataset.min,l.dataset.max):console.warn("Price slider UI elements (container, min/max display) not found."),m&&f&&h?(f.textContent=formatSqft(g),h.textContent=formatSqft(N),m.dataset.min=g,m.dataset.max=N,p&&(p.style.left="0%"),y&&(y.style.left="100%"),x&&(x.style.left="0%",x.style.width="100%"),m.dataset.min,m.dataset.max):console.warn("Area slider UI elements (container, min/max display) not found. Check '.sqr-range' selector and children.");const t=w.length;updateResultsCount(t),S&&(S.textContent=t)}(),setupRangeSlider("Price",s,o,i,c,d,u,l,formatCurrency),setupRangeSlider("Area",p,y,x,f,h,q,m,formatSqft);document.querySelectorAll(".card-wrapper").forEach((function(e){const t=e.querySelector(".sqr-min-card-value"),n=e.querySelector(".sqr-max-card-value"),r=e.querySelector(".sqr-spacer");t&&n&&r&&t.textContent===n.textContent&&(r.style.display="none",n.style.display="none");const a=e.querySelector(".price-min-card-value"),l=e.querySelector(".price-max-card-value"),s=e.querySelector(".price-spacer"),o=e.querySelector(".price-max-dollar"),i=e.querySelector(".startingat");a&&l&&s&&a.textContent===l.textContent&&(s.style.display="none",l.style.display="none",o&&(o.style.display="none"),i&&(i.style.display="inline"))}))}));